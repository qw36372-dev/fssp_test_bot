"""
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
"""

import os
from pathlib import Path
from typing import Dict, Any

# –ë–∞–∑–æ–≤—ã–µ –ø—É—Ç–∏
BASE_DIR = Path(__file__).resolve().parent.parent
DATA_DIR = BASE_DIR / "data"
QUESTIONS_DIR = DATA_DIR / "questions"

# Telegram Bot Token
BOT_TOKEN = os.getenv("BOT_TOKEN", "")

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_PATH = BASE_DIR / "fssp_bot.db"

# –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
SPECIALIZATIONS: Dict[str, Dict[str, Any]] = {
    "ispolniteli": {
        "name": "üìä –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",
        "emoji": "üìä",
        "description": "–í–æ–ø—Ä–æ—Å—ã –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º—É –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É",
        "file": "ispolniteli.json"
    },
    "oupds": {
        "name": "üö® –û–û–£–ü–î–°",
        "emoji": "üö®",
        "description": "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—É–¥–æ–≤",
        "file": "oupds.json"
    },
    "doznanie": {
        "name": "üéØ –î–æ–∑–Ω–∞–Ω–∏–µ",
        "emoji": "üéØ",
        "description": "–í–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–∑–Ω–∞–Ω–∏—é",
        "file": "doznanie.json"
    },
    "starshie": {
        "name": "üëî –£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
        "emoji": "üëî",
        "description": "–í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π",
        "file": "starshie.json"
    },
    "oko": {
        "name": "üìã –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
        "emoji": "üìã",
        "description": "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è",
        "file": "oko.json"
    },
    "rozisk": {
        "name": "üîç –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ–∑—ã—Å–∫",
        "emoji": "üîç",
        "description": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ–∑—ã—Å–∫ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–º—É—â–µ—Å—Ç–≤–∞",
        "file": "rozisk.json"
    },
    "informatizaciya": {
        "name": "üíª –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∑–∞—Ü–∏—è",
        "emoji": "üíª",
        "description": "–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
        "file": "informatizaciya.json"
    },
    "kadri": {
        "name": "üë• –ö–∞–¥—Ä–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞",
        "emoji": "üë•",
        "description": "–ö–∞–¥—Ä–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º",
        "file": "kadri.json"
    },
    "bezopasnost": {
        "name": "üõ°Ô∏è –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
        "emoji": "üõ°Ô∏è",
        "description": "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",
        "file": "bezopasnost.json"
    }
}

# –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
DIFFICULTY_LEVELS: Dict[str, Dict[str, Any]] = {
    "reserv": {
        "name": "ü•â –†–µ–∑–µ—Ä–≤",
        "questions_count": 20,
        "time_limit": 20,  # –º–∏–Ω—É—Ç
        "pass_threshold": 70  # –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
    },
    "base": {
        "name": "ü•à –ë–∞–∑–æ–≤—ã–π",
        "questions_count": 30,
        "time_limit": 30,
        "pass_threshold": 75
    },
    "standart": {
        "name": "ü•á –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π",
        "questions_count": 40,
        "time_limit": 40,
        "pass_threshold": 80
    },
    "advanced": {
        "name": "üíé –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π",
        "questions_count": 50,
        "time_limit": 50,
        "pass_threshold": 85
    }
}

# –û—Ü–µ–Ω–∫–∏
GRADING_SCALE = [
    (90, 100, "–û–¢–õ–ò–ß–ù–û ‚úÖ"),
    (80, 89, "–•–û–†–û–®–û üëç"),
    (70, 79, "–£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û üëå"),
    (0, 69, "–ù–ï–£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û ‚ùå")
]

# –≠–º–æ–¥–∑–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤
ANSWER_EMOJIS = ["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£", "4Ô∏è‚É£", "5Ô∏è‚É£"]

# Middleware –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
ANTISPAM_RATE_LIMIT = 3  # –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
ANTISPAM_TIMEOUT = 5  # —Å–µ–∫—É–Ω–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

# –¢–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
MESSAGES = {
    "start": """üß™ <b>–§–°–°–ü –¢–µ—Å—Ç-–±–æ—Ç</b>

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –§–°–°–ü –†–æ—Å—Å–∏–∏!

–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞:""",
    
    "ask_fio": """üë§ –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –§–ò–û:

<i>–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á</i>""",
    
    "ask_position": "üíº –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É –¥–æ–ª–∂–Ω–æ—Å—Ç—å:",
    
    "ask_department": "üè¢ –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:",
    
    "ask_difficulty": """üìä –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:

ü•â <b>–†–µ–∑–µ—Ä–≤</b> - 20 –≤–æ–ø—Ä–æ—Å–æ–≤, 20 –º–∏–Ω—É—Ç
ü•à <b>–ë–∞–∑–æ–≤—ã–π</b> - 30 –≤–æ–ø—Ä–æ—Å–æ–≤, 30 –º–∏–Ω—É—Ç
ü•á <b>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</b> - 40 –≤–æ–ø—Ä–æ—Å–æ–≤, 40 –º–∏–Ω—É—Ç
üíé <b>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</b> - 50 –≤–æ–ø—Ä–æ—Å–æ–≤, 50 –º–∏–Ω—É—Ç""",
    
    "test_started": """‚úÖ <b>–¢–µ—Å—Ç –Ω–∞—á–∞—Ç!</b>

‚è∞ –í—Ä–µ–º—è: {time_limit} –º–∏–Ω—É—Ç
üìù –í–æ–ø—Ä–æ—Å–æ–≤: {questions_count}

–î–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏.
–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

–£–¥–∞—á–∏! üçÄ""",
    
    "question_template": """‚è∞ –û—Å—Ç–∞–ª–æ—Å—å: {time_left}

üìù –í–æ–ø—Ä–æ—Å {current}/{total}

{question}""",
    
    "test_completed": """üèÜ <b>–¢–ï–°–¢ –ó–ê–í–ï–†–®–Å–ù!</b>

üë§ <b>–§–ò–û:</b> {fio}
üíº <b>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</b> {position}
üè¢ <b>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:</b> {department}
üìö <b>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</b> {specialization}
üìä <b>–£—Ä–æ–≤–µ–Ω—å:</b> {difficulty}

{grade}
üìà <b>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</b> {correct}/{total}
üíØ <b>–ü—Ä–æ—Ü–µ–Ω—Ç:</b> {percentage:.1f}%
‚è± <b>–í—Ä–µ–º—è:</b> {time_spent}""",
    
    "timeout": """‚è± <b>–í–†–ï–ú–Ø –í–´–®–õ–û!</b>

–¢–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à—ë–Ω.""",
    
    "error": "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
}
